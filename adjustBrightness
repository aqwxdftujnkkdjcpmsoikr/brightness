#! /usr/bin/bash

increment=10

readarray -t brights < brightness.txt
SCREEN1="HDMI-0"
briSCREEN1=${brights[0]}
SCREEN2="DP-4"
briSCREEN2=${brights[1]}
#manually add more variables if needed

if [ "$1" = 'update' ]; then
    xrandr --verbose | grep -m 2 -i brightness | cut -f2 -d ' ' | sed "s/^0\.//" | sed "s/\./0/" > brightness.txt
    exit
elif [ "$1" = 'refresh' ]; then
    foo=$(printf %.2f "$((briSCREEN1))e-2")
    xrandr --output "$SCREEN1" --brightness "$foo"
    foo=$(printf %.2f "$((briSCREEN2))e-2")
    xrandr --output "$SCREEN2" --brightness "$foo"
    #manually update here
    exit
elif [ "$1" = '+' ]; then
    if [[ -z "$2" || "$2" =~ "$SCREEN1" ]]; then
        let briSCREEN1=briSCREEN1+increment
        if [[ "$briSCREEN1" -gt "120" ]]; then
            briSCREEN1="120"
        fi
        foo=$(printf %.2f "$((briSCREEN1))e-2")
        xrandr --output "$SCREEN1" --brightness "$foo"
    fi
    if [[ -z "$2" || "$2" =~ "$SCREEN2" ]]; then
        let briSCREEN2=briSCREEN2+increment
        if [[ "$briSCREEN2" -gt "120" ]]; then
            briSCREEN2="120"
        fi
        foo=$(printf %.2f "$((briSCREEN2))e-2")
        xrandr --output "$SCREEN2" --brightness "$foo"
    fi
elif [ "$1" = '-' ]; then
    if [[ -z "$2" || "$2" =~ "$SCREEN1" ]]; then
        let briSCREEN1=briSCREEN1-increment
        if [[ "$briSCREEN1" -lt "0" ]]; then
            briSCREEN1="0"
        fi
        foo=$(printf %.2f "$((briSCREEN1))e-2")
        xrandr --output "$SCREEN1" --brightness "$foo"
    fi
    if [[ -z "$2" || "$2" =~ "$SCREEN2" ]]; then
        let briSCREEN2=briSCREEN2-increment
        if [[ "$briSCREEN2" -lt "0" ]]; then
            briSCREEN2="0"
        fi
        foo=$(printf %.2f "$((briSCREEN2))e-2")
        xrandr --output "$SCREEN2" --brightness "$foo"
    fi
fi

echo -e "$briSCREEN1\n$briSCREEN2" > brightness.txt
#manually update here too if you add screens
